<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - ShelfLife</title>
    <link rel="stylesheet" th:href="@{/css/professional.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>
<body>
<div class="app-container">
    <div th:replace="fragments/header :: header"></div>

    <main class="main-content">
        <!-- Welcome Section -->
        <div class="card mb-6">
            <div class="card-header">
                <h1 class="card-title">üëã Welcome to ShelfLife</h1>
            </div>
            <p class="text-secondary">Manage your food inventory efficiently and reduce waste with smart expiry tracking.</p>
        </div>

        <!-- Analytics Overview -->
        <div class="analytics-grid">
            <div class="analytics-card">
                <div class="card-icon">üì¶</div>
                <h3>Total Items</h3>
                <div class="value" th:text="${analytics.totalItems}">0</div>
            </div>
            <div class="analytics-card">
                <div class="card-icon">‚ö†Ô∏è</div>
                <h3>Expiring Soon</h3>
                <div class="value" th:text="${analytics.expiringSoonCount}">0</div>
            </div>
            <div class="analytics-card">
                <div class="card-icon">üö®</div>
                <h3>Expired Items</h3>
                <div class="value" th:text="${analytics.expiredItemsCount}">0</div>
            </div>
            <div class="analytics-card">
                <div class="card-icon">üìà</div>
                <h3>Waste Rate</h3>
                <div class="value" th:text="${#numbers.formatDecimal(analytics.wastePercentage, 1, 1)} + '%'">0%</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid-2 mb-6">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üöÄ Quick Actions</h2>
                </div>
                <div class="grid-2">
                    <a th:href="@{/add-item}" class="btn btn-primary text-center">
                        ‚ûï Add New Item
                    </a>
                    <a th:href="@{/inventory}" class="btn btn-primary text-center">
                        üìã View Inventory
                    </a>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Waste Analytics</h2>
                </div>
                <div class="text-center">
                    <div class="value mb-4" th:text="${#numbers.formatDecimal(analytics.wastePercentage, 1, 1)} + '%'">0%</div>
                    <p class="text-secondary">of your items have been wasted</p>
                </div>
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="grid-2">
            <!-- Expired Items -->
            <div class="card" th:if="${not expiredItems.empty}">
                <div class="alert-header">
                    <span class="alert-icon">üö®</span>
                    <h2>Expired Items</h2>
                </div>
                <div class="alert-items">
                    <div class="alert-item" th:each="item : ${expiredItems}">
                        <div class="item-info">
                            <div class="item-name" th:text="${item.name}"></div>
                            <div class="item-details">Expired on <span th:text="${item.expiryDate}"></span></div>
                        </div>
                        <form th:action="@{/dashboard/delete/{id}(id=${item.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('Delete this expired item?')">
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Expiring Soon -->
            <div class="card" th:if="${not expiringSoon.empty}">
                <div class="alert-header">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <h2>Expiring Soon</h2>
                </div>
                <div class="alert-items">
                    <div class="alert-item warning" th:each="item : ${expiringSoon}">
                        <div class="item-info">
                            <div class="item-name" th:text="${item.name}"></div>
                            <div class="item-details">
                                Expires in <span th:text="${daysUntilExpiry.get(item.id)}"></span> days
                            </div>
                        </div>
                        <form th:action="@{/dashboard/delete/{id}(id=${item.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm">
                                Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${foodItems.empty}" class="card text-center">
            <div class="card-header">
                <h2 class="card-title">üì≠ No Items Yet</h2>
            </div>
            <p class="text-secondary mb-4">Start managing your food inventory by adding your first item.</p>
            <a th:href="@{/add-item}" class="btn btn-primary">
                ‚ûï Add Your First Item
            </a>
        </div>
    </main>

    <div th:replace="fragments/footer :: footer"></div>
</div>
</body>
</html>